<!DOCTYPE html><html lang="ko"><head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link rel="icon" href="/favicon.ico"><meta name="generator" content="Astro v3.0.12"><!-- Canonical URL --><link rel="canonical" href="https://yrnana.dev/post/2021-03-24-table-of-contents-using-intersection-observer-api/"><!-- Primary Meta Tags --><title>Table Of Contents using Intersection Observer API | nana.log</title><meta name="title" content="Table Of Contents using Intersection Observer API | nana.log"><meta name="description" content="Table Of Contents는 목차를 의미하고, Intersection Observer API는 타겟요소가 상위요소(또는 viewport)와 Intersect 하는지 관찰하는 기능을 제공하는 Web API다."><meta name="keywords" content="React,Table Of Contents,Intersection Observer API"><!-- Open Graph / Facebook --><meta property="og:type" content="article"><meta property="og:url" content="https://yrnana.dev/post/2021-03-24-table-of-contents-using-intersection-observer-api/"><meta property="og:title" content="Table Of Contents using Intersection Observer API | nana.log"><meta property="og:description" content="Table Of Contents는 목차를 의미하고, Intersection Observer API는 타겟요소가 상위요소(또는 viewport)와 Intersect 하는지 관찰하는 기능을 제공하는 Web API다."><meta property="og:image" content="https://yrnana.dev/_astro/nana.log.1a2324ba_Zs7AU.png"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://yrnana.dev/post/2021-03-24-table-of-contents-using-intersection-observer-api/"><meta property="twitter:title" content="Table Of Contents using Intersection Observer API | nana.log"><meta property="twitter:description" content="Table Of Contents는 목차를 의미하고, Intersection Observer API는 타겟요소가 상위요소(또는 viewport)와 Intersect 하는지 관찰하는 기능을 제공하는 Web API다."><meta property="twitter:image" content="https://yrnana.dev/_astro/nana.log.1a2324ba_Zs7AU.png"><!-- Font --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap"><!-- Google Ads --><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4675264961434940" crossOrigin="anonymous"></script><link rel="stylesheet" href="https://unpkg.com/applause-button/dist/applause-button.css"><link rel="stylesheet" href="/_astro/about.10a58b93.css" /><script type="module" src="/_astro/hoisted.69edc630.js"></script>
<script type="module" src="/_astro/page.30c903a1.js"></script></head><body><div class="container mx-auto px-4 flex flex-col min-h-screen"><header class="mt-4 sm:mt-6 flex flex-row items-center"><div class="mr-auto"><a href="/" class="select-none text-xl sm:text-2xl font-semibold font-mono hover:text-violet-500">
nana.log
</a></div><nav class="flex flex-row items-center space-x-4"><a href="/about" class="text-sm sm:text-base hover:text-violet-500">About</a><a href="/archive" class="text-sm sm:text-base hover:text-violet-500">Archive</a><a href="/tags" class="text-sm sm:text-base hover:text-violet-500">Tags</a></nav></header><main class="py-10 flex-grow"><article class="mb-20"><header class="text-center mt-10 mb-20"><h1 class="text-3xl font-semibold">Table Of Contents using Intersection Observer API</h1><div class="text-slate-500 mt-4">Mar 24, 2021</div><div class="flex flex-row flex-wrap justify-center space-x-3 mt-4"><a href="/tag/react" class="select-none inline-flex items-center text-sm leading-4 rounded-full px-4 py-1.5 text-violet-500 bg-violet-100 hover:text-violet-700 hover:bg-violet-200"><span>React</span></a><a href="/tag/table-of-contents" class="select-none inline-flex items-center text-sm leading-4 rounded-full px-4 py-1.5 text-violet-500 bg-violet-100 hover:text-violet-700 hover:bg-violet-200"><span>Table Of Contents</span></a><a href="/tag/intersection-observer-api" class="select-none inline-flex items-center text-sm leading-4 rounded-full px-4 py-1.5 text-violet-500 bg-violet-100 hover:text-violet-700 hover:bg-violet-200"><span>Intersection Observer API</span></a></div></header><div class="markdown"><p><code>Table Of Contents</code>는 목차를 의미하고, <a href="/post/2021-03-14-intersection-observer-api">Intersection Observer API</a>는 타겟요소가 상위요소(또는 viewport)와 Intersect 하는지 관찰하는 기능을 제공하는 Web API다.</p>
<p>구현해야 할 기능과 방법을 생각해보면</p>
<ul>
<li>글에서 헤더(<code>h1</code>~<code>h6</code>)를 뽑아서 목차 목록을 생성</li>
<li><code>IntersectionObserver</code> 인스턴스를 생성하고 헤더들을 관찰하도록 함</li>
<li>viewport 내에 보여지는 헤더들 중 가장 상위 헤더를 기준으로 활성화 목차를 결정</li>
<li>목차 아이템 클릭 시 헤더 위치로 이동</li>
</ul>
<p>목차 아이템은 다음과 같은 인터페이스를 가진다.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color:#282c34;overflow-x:auto" tabIndex="0"><code><span class="line"><span style="color:#C678DD">export</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">interface</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">TableOfContent</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">index</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">number</span><span style="color:#ABB2BF">; </span><span style="color:#7F848E;font-style:italic">// key로 활용 가능한 목차 index</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">text</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">string</span><span style="color:#ABB2BF">; </span><span style="color:#7F848E;font-style:italic">// 목차 컨텐츠</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">marginLeft</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">number</span><span style="color:#ABB2BF">; </span><span style="color:#7F848E;font-style:italic">// h1이면 0px, h6이면 50px</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">offsetTop</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">number</span><span style="color:#ABB2BF">; </span><span style="color:#7F848E;font-style:italic">// 헤더의 y 위치</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre>
<p>헤더들의 <code>offsetTop</code>을 한번만 읽고 끝내기 위해서 목차 정보에 <code>offsetTop</code>을 저장하는데, 이를 오차 없이 사용하려면 저장한 후에 내부에서 height 변동이 없어야 한다. (예를 들면 lazy loading이 되는 이미지가 있다면 Layout Shift가 발생하지 않도록 주의해야 한다)</p>
<p>목차는 딱 하나만 활성화 되어야 하는데, viewport 기준 가장 위의 헤더 또는 해당하는 컨텐츠의 헤더 index가 <code>activeIndex</code>가 된다. 이를 계산하기 위해 <code>IntersectionObserver</code> 인스턴스 내부에서 전달받는 entries 정보를 한번 흩어서 배열(=<code>intersectingList</code>)에 교차 여부를 저장한다. 예를 들면 이 배열에서 <code>intersectingList[2]</code>는 현재 3번째 헤더의 viewport 교차 여부를 나타내게 된다.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color:#282c34;overflow-x:auto" tabIndex="0"><code><span class="line"><span style="color:#E5C07B">entries</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">forEach</span><span style="color:#ABB2BF">(({ </span><span style="color:#E06C75;font-style:italic">target</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75;font-style:italic">isIntersecting</span><span style="color:#ABB2BF"> }) </span><span style="color:#C678DD">=&gt;</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">idx</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">Number</span><span style="color:#ABB2BF">((</span><span style="color:#E06C75">target</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">as</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">HTMLElement</span><span style="color:#ABB2BF">).</span><span style="color:#E5C07B">dataset</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">id</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">||</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">intersectingList</span><span style="color:#ABB2BF">[</span><span style="color:#E06C75">idx</span><span style="color:#ABB2BF">] </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">isIntersecting</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">});</span></span></code></pre>
<p>이후 <code>intersectingList</code>의 item 중 가장 처음으로 true가 되는 인덱스를 찾는다. 이렇게 하면 <code>O(2n)</code>으로 <code>activeIndex</code>를 찾을 수 있다. <code>threshold</code>를 <code>1.0</code>으로 지정하면 요소 전체가 보여야 true로 잡히기 때문에 위에서 찾은 index에서 1을 감하면 <code>activeIndex</code>가 된다. (이렇게 찾는 이유는 <code>n</code>번째 헤더는 보이지 않고 <code>n</code>번째 헤더의 컨텐츠만 보이더라도 <code>activeIndex</code>는 <code>n</code>이어야 하기 때문이다)</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color:#282c34;overflow-x:auto" tabIndex="0"><code><span class="line"><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">currentIndex</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">intersectingList</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">findIndex</span><span style="color:#ABB2BF">((</span><span style="color:#E06C75;font-style:italic">item</span><span style="color:#ABB2BF">) </span><span style="color:#C678DD">=&gt;</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">item</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD">let</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">activeIndex</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">currentIndex</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">-</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">if</span><span style="color:#ABB2BF"> (</span><span style="color:#E06C75">currentIndex</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">===</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">-</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">activeIndex</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">intersectingList</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">length</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">-</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">; </span><span style="color:#7F848E;font-style:italic">// 찾을 수 없는 경우 마지막 인덱스로 지정</span></span>
<span class="line"><span style="color:#ABB2BF">} </span><span style="color:#C678DD">else</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">if</span><span style="color:#ABB2BF"> (</span><span style="color:#E06C75">currentIndex</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">===</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">activeIndex</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">; </span><span style="color:#7F848E;font-style:italic">// 인덱스는 0 이상이어야 한다</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span>
<span class="line"><span style="color:#61AFEF">setActiveIndex</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">activeIndex</span><span style="color:#ABB2BF">);</span></span></code></pre>
<p>이 로직을 훅으로 구현하면 다음과 같다.</p>
<pre is:raw="" class="astro-code one-dark-pro" style="background-color:#282c34;overflow-x:auto" tabIndex="0"><code><span class="line"><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">useTableOfContents</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=&gt;</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">contentRef</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">useRef</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">HTMLElement</span><span style="color:#ABB2BF">&gt;(</span><span style="color:#D19A66">null</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">intersectingListRef</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">useRef</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">boolean</span><span style="color:#ABB2BF">[]&gt;([]); </span><span style="color:#7F848E;font-style:italic">// isIntersecting array</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> [</span><span style="color:#E5C07B">tableOfContents</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">setTableOfContents</span><span style="color:#ABB2BF">] </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">useState</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">TableOfContent</span><span style="color:#ABB2BF">[]&gt;([]);</span></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> [</span><span style="color:#E5C07B">activeIndex</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">setActiveIndex</span><span style="color:#ABB2BF">] </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">useState</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#61AFEF">useEffect</span><span style="color:#ABB2BF">(() </span><span style="color:#C678DD">=&gt;</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">intersectingList</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">intersectingListRef</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">current</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">content</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">contentRef</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">current</span><span style="color:#56B6C2">!</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">headers</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">content</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">querySelectorAll</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">HTMLElement</span><span style="color:#ABB2BF">&gt;(</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#98C379">&#39;h1, h2, h3, h4, h5, h6&#39;</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">    ); </span><span style="color:#7F848E;font-style:italic">// all headers</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#7F848E;font-style:italic">// set TableOfContents</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">tocData</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">Array</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">from</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">headers</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">map</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">TableOfContent</span><span style="color:#ABB2BF">&gt;((</span><span style="color:#E06C75;font-style:italic">header</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75;font-style:italic">i</span><span style="color:#ABB2BF">) </span><span style="color:#C678DD">=&gt;</span><span style="color:#ABB2BF"> ({</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E06C75">index</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">i</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E06C75">text</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">header</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">textContent</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">||</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">&#39;&#39;</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E06C75">marginLeft</span><span style="color:#ABB2BF">: (</span><span style="color:#61AFEF">Number</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">header</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">tagName</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">charAt</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">)) </span><span style="color:#56B6C2">-</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">) </span><span style="color:#56B6C2">*</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E06C75">offsetTop</span><span style="color:#ABB2BF">: </span><span style="color:#E5C07B">header</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">offsetTop</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">+</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">, </span><span style="color:#7F848E;font-style:italic">// have to down little bit</span></span>
<span class="line"><span style="color:#ABB2BF">    }));</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#61AFEF">setTableOfContents</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">tocData</span><span style="color:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#7F848E;font-style:italic">// create IntersectionObserver</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">observer</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">IntersectionObserver</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF">      (</span><span style="color:#E06C75;font-style:italic">entries</span><span style="color:#ABB2BF">) </span><span style="color:#C678DD">=&gt;</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#7F848E;font-style:italic">// save isIntersecting info to array using data-id</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E5C07B">entries</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">forEach</span><span style="color:#ABB2BF">(({ </span><span style="color:#E06C75;font-style:italic">target</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75;font-style:italic">isIntersecting</span><span style="color:#ABB2BF"> }) </span><span style="color:#C678DD">=&gt;</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">          </span><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">idx</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">Number</span><span style="color:#ABB2BF">((</span><span style="color:#E06C75">target</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">as</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">HTMLElement</span><span style="color:#ABB2BF">).</span><span style="color:#E5C07B">dataset</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">id</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">||</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">          </span><span style="color:#E06C75">intersectingList</span><span style="color:#ABB2BF">[</span><span style="color:#E06C75">idx</span><span style="color:#ABB2BF">] </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">isIntersecting</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">        });</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#7F848E;font-style:italic">// get activeIndex</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#C678DD">const</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">currentIndex</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">intersectingList</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">findIndex</span><span style="color:#ABB2BF">((</span><span style="color:#E06C75;font-style:italic">item</span><span style="color:#ABB2BF">) </span><span style="color:#C678DD">=&gt;</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">item</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#C678DD">let</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">activeIndex</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">currentIndex</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">-</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#C678DD">if</span><span style="color:#ABB2BF"> (</span><span style="color:#E06C75">currentIndex</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">===</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">-</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#ABB2BF">          </span><span style="color:#E06C75">activeIndex</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#E5C07B">intersectingList</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">length</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">-</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">        } </span><span style="color:#C678DD">else</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">if</span><span style="color:#ABB2BF"> (</span><span style="color:#E06C75">currentIndex</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">===</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#ABB2BF">          </span><span style="color:#E06C75">activeIndex</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF">        </span><span style="color:#61AFEF">setActiveIndex</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">activeIndex</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">      },</span></span>
<span class="line"><span style="color:#ABB2BF">      { </span><span style="color:#E06C75">threshold</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF">    );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E5C07B">headers</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">forEach</span><span style="color:#ABB2BF">((</span><span style="color:#E06C75;font-style:italic">header</span><span style="color:#ABB2BF">, </span><span style="color:#E06C75;font-style:italic">i</span><span style="color:#ABB2BF">) </span><span style="color:#C678DD">=&gt;</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E5C07B">header</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setAttribute</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&#39;data-id&#39;</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">i</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">toString</span><span style="color:#ABB2BF">()); </span><span style="color:#7F848E;font-style:italic">// set data-id</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E5C07B">intersectingList</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">push</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">false</span><span style="color:#ABB2BF">); </span><span style="color:#7F848E;font-style:italic">// increase array length</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E5C07B">observer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">observe</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">header</span><span style="color:#ABB2BF">); </span><span style="color:#7F848E;font-style:italic">// register to observe</span></span>
<span class="line"><span style="color:#ABB2BF">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">return</span><span style="color:#ABB2BF"> () </span><span style="color:#C678DD">=&gt;</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E5C07B">observer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">disconnect</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E5C07B">intersectingList</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">length</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">=</span><span style="color:#ABB2BF"> </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">; </span><span style="color:#7F848E;font-style:italic">// empty array</span></span>
<span class="line"><span style="color:#ABB2BF">    };</span></span>
<span class="line"><span style="color:#ABB2BF">  }, []);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">return</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">contentRef</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">tableOfContents</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">activeIndex</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF">  };</span></span>
<span class="line"><span style="color:#ABB2BF">};</span></span></code></pre>
<p>이 훅을 사용한 목차를 구현했더니 뭔가 삐걱삐걱..</p>
<iframe width="1000" height="500" src="https://codesandbox.io/embed/tableofcontents-using-intersection-observer-api-in-react-0jcox" style="width:1000px;height:500px;border:0;border-radius:4px;overflow:hidden" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></div></article><div class="flex items-center justify-center"><applause-button class="applause" multiclap="true" style="width: 58px; height: 58px;" url="https://yrnana.dev/post/2021-03-24-table-of-contents-using-intersection-observer-api/"></applause-button></div><div class="flex mt-10 -mb-10"><div class="max-w-2/5"><a href="/post/2021-03-25-offsettop-reflow" class="hover:text-violet-700 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-400 mr-1 flex-shrink-0" fill="none"
  viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
</svg><div><div class="text-xs text-slate-500">Previous</div><div>OffsetTop을 읽으면 reflow가 발생한다?</div></div></a></div><div class="max-w-2/5 text-right ml-auto"><a href="/post/2021-03-21-prettier-eslint" class="hover:text-violet-700 flex items-center"><div><div class="text-xs text-slate-500">Next</div><div>prettier와 eslint를 구분해서 사용하자</div></div><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-400 ml-1 flex-shrink-0" fill="none"
  viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
</svg></a></div></div><div class="mt-20 relative" style="min-height:269"><script src="https://utteranc.es/client.js" repo="yrnana/yrnana.github.io" issue-term="2021-03-24-table-of-contents-using-intersection-observer-api" label="comment" theme="github-light" crossorigin="anonymous" async></script></div></main><footer class="mb-4 sm:mb-6 text-center text-slate-700"><span class="mr-1 text-sm sm:text-base">
Copyright &copy; 2023</span><span>nana</span></footer></div><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></body></html>