<!DOCTYPE html>
<html lang="ko">
  <head>
    <!-- Global Metadata --><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="icon" href="/favicon.ico">
<meta name="generator" content="Astro v2.0.6">

<!-- Canonical URL -->
<link rel="canonical" href="https://yrnana.dev/post/2021-12-08-blog-move/">

<!-- Primary Meta Tags -->
<title>블로그 이사 후기 | nana.log</title>
<meta name="title" content="블로그 이사 후기 | nana.log">
<meta name="description" content="velog에서 깃헙 블로그로 이사한 이유와 개발 후기">
<meta name="keywords" content="etc">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="article">
<meta property="og:url" content="https://yrnana.dev/post/2021-12-08-blog-move/">
<meta property="og:title" content="블로그 이사 후기 | nana.log">
<meta property="og:description" content="velog에서 깃헙 블로그로 이사한 이유와 개발 후기">
<meta property="og:image" content="https://yrnana.dev/_astro/nana.log.1a2324ba_Z1XgAIx.png">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://yrnana.dev/post/2021-12-08-blog-move/">
<meta property="twitter:title" content="블로그 이사 후기 | nana.log">
<meta property="twitter:description" content="velog에서 깃헙 블로그로 이사한 이유와 개발 후기">
<meta property="twitter:image" content="https://yrnana.dev/_astro/nana.log.1a2324ba_Z1XgAIx.png">

<!-- Font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap">

<!-- Google Ads -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4675264961434940" crossOrigin="anonymous"></script><link rel="stylesheet" href="https://unpkg.com/applause-button/dist/applause-button.css">
  <link rel="stylesheet" href="/_astro/about.4d05d472.css" /><script type="module" src="/_astro/hoisted.69edc630.js"></script>
<script type="module" src="/_astro/page.b7cc8384.js"></script></head>
  <body>
    <div class="container mx-auto px-4 flex flex-col min-h-screen">
      <header class="mt-4 sm:mt-6 flex flex-row items-center">
  <div class="mr-auto">
    <a href="/" class="select-none text-xl sm:text-2xl font-semibold font-mono hover:text-violet-500">
      nana.log
    </a>
  </div>
  <nav class="flex flex-row items-center space-x-4">
    <a href="/about" class="text-sm sm:text-base hover:text-violet-500">
          About
        </a><a href="/archive" class="text-sm sm:text-base hover:text-violet-500">
          Archive
        </a><a href="/tags" class="text-sm sm:text-base hover:text-violet-500">
          Tags
        </a>
  </nav>
</header>
      <main class="py-10 flex-grow">
        <article class="mb-20">
  <header class="text-center mt-10 mb-20">
    
    <h1 class="text-3xl font-semibold">블로그 이사 후기</h1>
    <div class="text-slate-500 mt-4">Dec 8, 2021</div>
    <div class="flex flex-row flex-wrap justify-center space-x-3 mt-4">
          <a href="/tag/etc" class="select-none inline-flex items-center text-sm leading-4 rounded-full px-4 py-1.5 text-violet-500 bg-violet-100 hover:text-violet-700 hover:bg-violet-200">
  <span>etc</span>
  
</a>
        </div>
  </header>
  <div class="markdown">
    <h2 id="블로그-옮긴-이유">블로그 옮긴 이유<a class="autolink" aria-hidden="true" tabIndex="-1" href="#블로그-옮긴-이유"><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="24" height="24" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2>
<p><a href="https://velog.io/@yrnana" target="_blank" rel="nofollow">velog</a>가 편하고 좋긴 한데 코드 블록이 마음에 안들어서 옮겼다.</p>
<h2 id="기술-스택">기술 스택<a class="autolink" aria-hidden="true" tabIndex="-1" href="#기술-스택"><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="24" height="24" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2>
<ul>
<li>Gatsby(v4)</li>
<li>TypeScript</li>
<li>Tailwind CSS</li>
</ul>
<p>나는 리액트와 타입스크립트의 노예니까 당연히 TS 기반으로 진행하려고 했다. 문제는 <code>Next.js</code>를 쓰느냐, <code>Gatsby</code>를 쓰느냐 였는데, 요즘 워낙 Next.js가 잘나가다보니 <a href="https://github.com/yrnana/yrnana.github.io/tree/v2" target="_blank" rel="nofollow">처음엔 Next.js로 구축</a>했다.</p>
<p>다 만들고보니 블로그 개발 이라는 테마에 있어서 오히려 단점이 몇가지 있었다.</p>
<blockquote>
<ul>
<li>마크다운 파싱 함수, 페이징 api 등 전부 직접 개발해야 함</li>
<li>개발모드에서 마크다운을 수정해도 HMR 적용되지 않음</li>
<li>postcss 컴파일 속도가 너무 느림</li>
<li>SSG 모드에서는 이미지 최적화 기능을 지원하지 않음</li>
</ul>
</blockquote>
<p>그래서 결국 Gatsby로 갈아 엎었는데 위와 같은 단점을 해결할 수 있었다. Gatsby의 경우 <code>GraphQL</code>로 마크다운 및 여러가지 파일들을 조회하고 가공할 수 있도록 제공하기 때문에 매우 편리하다.</p>
<h2 id="gatsby">Gatsby<a class="autolink" aria-hidden="true" tabIndex="-1" href="#gatsby"><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="24" height="24" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2>
<p>Gatsby는 개발자가 각종 세팅을 쉽게 적용할 수 있도록 여러가지 플러그인을 제공하고 있다. 처음에 마크다운 프로세서 플러그인으로 <code>gatsby-plugin-mdx</code>를 사용했다가 <code>gatsby-transformer-remark</code>로 바꿨는데, 이는 일부 플러그인 (e.g. <code>gatsby-remark-katex</code>)이 디펜던시 문제로 후자에서만 작동하기 때문이다. 알고리즘 관련 포스트를 작성하려면 수식 작성이 필요해서 katex를 버릴 순 없었다.</p>
<p>그리고 <code>graphql-codegen</code>으로 Type을 자동 생성하여 타입스크립트를 십분 활용할 수 있도록 적용했다. 또한 GraphQL 스키마는 대부분 auto detecting을 하는데, <code>gatsby-node.js</code>에서 스키마를 직접 지정 &amp; 확장해서 GraphQL를 aggregate도 하고 graphql-codegen의 타입 output을 좀더 명확하게 지정할 수 있었다.</p>
<p>처음엔 ts 파일로 gatsby-* 설정 파일들을 작성했는데, ts-node나 추가 플러그인을 설치해야 하는 점도 별로고 js 파일로 작성해야 초기 로드가 빠를 것 같아서 그냥 js 파일을 사용하고 IDE의 타입 지정 코멘트를 활용했다.</p>
<h2 id="markdown">Markdown<a class="autolink" aria-hidden="true" tabIndex="-1" href="#markdown"><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="24" height="24" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2>
<p>블로그이니만큼 가장 공을 들인 부분이 마크다운 프로세싱인데, 사실 Gatsby에서 기본적인 처리는 다 해주기 때문에 부가적인 처리만 해주면 된다. 다만 초기에 Next.js로 개발할 때는 직접 파싱하고 뿌려야 했기 때문에 나름대로 학습을 했다. 마크다운을 처리할때는 보통 <code>unified</code>라는 <code>syntax tree</code>로 텍스트를 처리하는 인터페이스를 활용한다. 비단 마크다운만 처리하는 용도는 아니고, markdown, natural language, html 을 지원하고 포맷간 변환을 지원한다.</p>

<p><figure><picture>
	<source type="image/png" srcset="/_astro/unified.7731b51b_ZFw0jw.png 480w,/_astro/unified.7731b51b_1Yd1zQ.png 790w" sizes="(max-width: 790px) 100vw, 790px"><source type="image/webp" srcset="/_astro/unified.7731b51b_ZwACoz.webp 480w,/_astro/unified.7731b51b_N61Da.webp 790w" sizes="(max-width: 790px) 100vw, 790px">
	<img alt="unified" src="/_astro/unified.7731b51b_N61Da.webp" loading="lazy" decoding="async" alt="unified">
</picture><figcaption>unified</figcaption></figure></p>
<p>input을 parser를 통해 syntax tree로 파싱하고 이 tree를 transformer를 통해 가공한 뒤 compiler로 output을 만들 수 있다. 즉, 마크다운 파일이 input이라면 이를 <code>mdast(markdown syntax tree)</code>로 만들고 여기에 어떠한 처리 (e.g. autolink) 를 한 뒤 html string으로 변환하는 것이다. 아니면 mdast를 <code>hast(html syntax tree)</code>로 바꾸고 가공 후 html으로 변환해도 된다.</p>
<p>GraphQL에서 <code>html</code>과 <code>htmlAst(hast)</code> 두가지를 제공하는데, 나는 <code>dangerouslySetInnerHTML</code>을 사용해서 html을 출력하는 대신 위의 stringify 단계를 <code>rehype-react</code>라는 컴파일러로 처리했다.</p>
<p>또한 Gatsby v4에서 지원하지 않는 일부 플러그인을 <code>&lt;root&gt;/plugins</code>에 직접 작성해서 <code>gatsby-config.js</code>에 적용했는데, 이 때 주의할 점은 현재 unified 관련 패키지들은 전부 <strong>ESM only</strong> 인데 <code>gatsby-config.js</code>는 노드 환경에서 돌아가기 때문에 오류가 난다. 따라서 이 패키지들은 cjs를 지원하는 낮은 버전으로 다운그레이드 해서 설치해야 한다. (e.g. <code>remark-breaks</code>)</p>
<h2 id="이사-한달-후기">이사 한달 후기<a class="autolink" aria-hidden="true" tabIndex="-1" href="#이사-한달-후기"><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="24" height="24" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2>
<p>lighthouse에서 SEO 만점이 나오는데도 검색에 안 걸린다ㅠㅠ<br/>
벨로그는 검색에 정말 잘 걸리는게 큰 장점인듯…<br/>
그리고 좋아요 같은 기능을 붙이고 싶어서 언젠가는 SSR로 옮길까 하고 도메인을 붙였다.</p>
<h2 id="이사-5달-후기">이사 5달 후기<a class="autolink" aria-hidden="true" tabIndex="-1" href="#이사-5달-후기"><svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="24" height="24" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2>
<p>검색에 꽤 잘 걸린다… velog 때도 그렇지만 은근 검색이 잘 걸리는 편인듯… 왤까요… 좋은데 싫어(?)… 지금이라도 존댓말 쓸까요?🥺</p>
  </div>
</article><div class="flex items-center justify-center">
      <applause-button class="applause" multiclap="true" style="width: 58px; height: 58px;" url="https://yrnana.dev/post/2021-12-08-blog-move/"></applause-button>
    </div><div class="flex mt-10 -mb-10">
  <div class="max-w-2/5">
    <a href="2021-12-09-next.js" class="hover:text-violet-700 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-400 mr-1 flex-shrink-0" fill="none"
  viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
</svg>
          <div>
            <div class="text-xs text-slate-500">Previous</div>
            <div>Next.js에서 카카오맵 사용하기</div>
          </div>
        </a>
  </div>
  <div class="max-w-2/5 text-right ml-auto">
    <a href="2021-11-28-lodash-lodash-es" class="hover:text-violet-700 flex items-center">
          <div>
            <div class="text-xs text-slate-500">Next</div>
            <div>lodash 대신 lodash-es 쓰자</div>
          </div>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-400 ml-1 flex-shrink-0" fill="none"
  viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
</svg>
        </a>
  </div>
</div><div class="mt-20 relative" style="min-height:269">
  <script src="https://utteranc.es/client.js" repo="yrnana/yrnana.github.io" issue-term="2021-12-08-blog-move" label="comment" theme="github-light" crossorigin="anonymous" async></script>
</div>
      </main>
      <footer class="mb-4 sm:mb-6 text-center text-slate-700">
  <span class="mr-1 text-sm sm:text-base">
    Copyright &copy; 2023
  </span>
  <span>nana</span>
</footer>
    </div>
    <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </body></html>